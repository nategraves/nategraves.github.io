(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function a(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(n){if(n.ep)return;n.ep=!0;const l=a(n);fetch(n.href,l)}})();const I=20,de=38,me=8,fe=.1,Ee=8,ge="16px sans-serif",Se=100,pe=I*.7,ye=.2,ue=I*2.5,_e=I*.3,he=I*.5,Ae=I*.1,Le=I+5,Te=3,xe="12px sans-serif",ve=5,Ne=["Team 1","Team 2"],Me=["#f00","#00f"],Ie=Object.freeze(Object.defineProperty({__proto__:null,AIM_OFFSET:de,AIM_RADIUS:me,BALLOON_RADIUS:Ee,BASE_UMBRELLA_OFFSET_Y_PX:Le,DEAD_ZONE:fe,LERP_FACTOR:ye,MAX_WETNESS:Se,PLAYER_NAME_FONT:xe,PLAYER_NAME_OFFSET_Y:ve,PLAYER_RADIUS:I,SCORE_FONT:ge,TEAM_DISPLAY_NAMES:Ne,TEAM_HEX_COLORS:Me,UMBRELLA_HANDLE_LENGTH_PX:he,UMBRELLA_HANDLE_THICKNESS_PX:Ae,UMBRELLA_MAX_REACH_MULTIPLIER_CLIENT:Te,UMBRELLA_THICKNESS_PX:_e,UMBRELLA_WIDTH_PX:ue,WETNESS_RADIUS:pe},Symbol.toStringTag,{value:"Module"}));function Oe(o,t){let a=0,r=0,n=0;const l=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;o=o.replace(l,(A,L,T,v)=>"#"+L+L+T+T+v+v);const c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(o);return c?(a=parseInt(c[1],16),r=parseInt(c[2],16),n=parseInt(c[3],16),`rgba(${a}, ${r}, ${n}, ${t})`):`rgba(255, 255, 255, ${t})`}function Pe(o,t,a,r,n){o.addEventListener("open",()=>{a.textContent="Connected",Object.entries(t).forEach(([l,c])=>{o.send(JSON.stringify({type:"init",clientId:c,playerName:q(c)}))})}),o.addEventListener("message",l=>{const c=JSON.parse(l.data);c.type==="state"?n(c.state):c.type==="level"&&(r.value=c.levelId)}),o.addEventListener("close",()=>{a.textContent="Disconnected"}),o.addEventListener("error",()=>{a.textContent="Error"})}const we=Object.freeze(Object.defineProperty({__proto__:null,connectWebSocket:Pe,hexToRgba:Oe},Symbol.toStringTag,{value:"Module"})),{PLAYER_RADIUS:N,AIM_OFFSET:te,AIM_RADIUS:Re,DEAD_ZONE:k,BALLOON_RADIUS:ne,MAX_WETNESS:be,LERP_FACTOR:Ce,UMBRELLA_WIDTH_PX:se,UMBRELLA_THICKNESS_PX:oe,UMBRELLA_HANDLE_THICKNESS_PX:ie,BASE_UMBRELLA_OFFSET_Y_PX:Be,UMBRELLA_MAX_REACH_MULTIPLIER_CLIENT:$e,PLAYER_NAME_FONT:De,PLAYER_NAME_OFFSET_Y:Fe,TEAM_HEX_COLORS:p}=Ie,{hexToRgba:Xe}=we,G=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;console.log("Client ID:",G);const re=[{id:"level1",name:"Level 1"},{id:"level2",name:"Level 2"}];let B=re[0].id;const S=document.createElement("div");S.style.position="fixed";S.style.top="10px";S.style.left="10px";S.style.zIndex="100";S.style.background="rgba(255,255,255,0.8)";S.style.padding="5px";const R=document.createElement("select");re.forEach(o=>{const t=document.createElement("option");t.value=o.id,t.text=o.name,R.appendChild(t)});R.value=B;S.appendChild(R);const w=document.createElement("span");w.textContent="Connecting...";w.style.marginLeft="10px";S.appendChild(w);const z=document.createElement("div");z.style.marginTop="5px";z.innerHTML='Game Scores: <span id="team0name">Team 1</span>: <span id="team0score" style="font-weight: bold;">0</span> - <span id="team1name">Team 2</span>: <span id="team1score" style="font-weight: bold;">0</span>';S.appendChild(z);const K=document.createElement("div");K.style.marginTop="5px";K.innerHTML='Session Wins: <span id="team0sessionname">Team 1</span>: <span id="team0sessionwins" style="font-weight: bold;">0</span> - <span id="team1sessionname">Team 2</span>: <span id="team1sessionwins" style="font-weight: bold;">0</span>';S.appendChild(K);const j=document.createElement("div");j.style.marginTop="5px";j.innerHTML='Friendly Fire: <span id="ffStatus">ON</span>';S.appendChild(j);document.body.appendChild(S);const i=document.getElementById("gameCanvas"),e=i.getContext("2d");i.width=window.innerWidth;i.height=window.innerHeight;function Ue(){i.width=window.innerWidth,i.height=window.innerHeight}window.addEventListener("resize",Ue);let m;const C=new Map;function q(o){if(C.has(o))return C.get(o);let t=localStorage.getItem(`fiveteenPlayerName_${o}`);if(!t){const a=o.includes("-")?o.split("-").pop():o;t=prompt(`Enter player name for controller ${a} (max 8 characters):`),t&&t.length>8&&(t=t.substring(0,8)),t||(t=`Player${Math.floor(Math.random()*1e3)}`),localStorage.setItem(`fiveteenPlayerName_${o}`,t)}return C.set(o,t),t}function We(){const o="wss",t="fiveteen.netlify.app",a="";m=new WebSocket(`${o}://${t}${a}`),m.addEventListener("open",()=>{w.textContent="Connected",Object.entries(M).forEach(([r,n])=>{m.send(JSON.stringify({type:"init",clientId:n,playerName:q(n)}))})}),m.addEventListener("message",r=>{try{const n=JSON.parse(r.data);n.type==="state"?(Ye(n.state),le=n.state.gameOver):n.type==="level"&&(B=n.levelId,R.value=B)}catch{}}),m.addEventListener("close",()=>{w.textContent="Disconnected"}),m.addEventListener("error",()=>{w.textContent="Error"})}We();R.addEventListener("change",()=>{B=R.value,m.readyState===WebSocket.OPEN&&m.send(JSON.stringify({type:"level",levelId:B}))});const ae=new Map;function Ye(o){e.clearRect(0,0,i.width,i.height);const{players:t,balloons:a,teamScores:r,friendlyFireEnabled:n,gameOver:l,winningTeam:c,persistentPlayerStats:A,teamSessionWins:L,teamNames:T}=o;T&&T.length>0&&(P=T);const v=document.getElementById("team0score"),$=document.getElementById("team1score"),f=document.getElementById("team0name"),b=document.getElementById("team1name");v&&$&&r&&f&&b&&(f.textContent=P[0],f.style.color=p[0],v.textContent=r[0].toString(),b.textContent=P[1],b.style.color=p[1],$.textContent=r[1].toString());const Q=document.getElementById("team0sessionwins"),V=document.getElementById("team1sessionwins"),F=document.getElementById("team0sessionname"),X=document.getElementById("team1sessionname");Q&&V&&L&&F&&X&&(F.textContent=P[0],F.style.color=p[0],Q.textContent=L[0].toString(),X.textContent=P[1],X.style.color=p[1],V.textContent=L[1].toString());const U=document.getElementById("ffStatus");U&&(U.textContent=n?"ON":"OFF",U.style.color=n?"green":"red");const ee=document.getElementById("restartButton");if(ee&&ee.remove(),l){e.fillStyle="rgba(0, 0, 0, 0.75)",e.fillRect(0,0,i.width,i.height),e.font="48px sans-serif",e.fillStyle="white",e.textAlign="center";const s=c!==null?`${P[c]} Wins!`:"Game Over!";if(e.fillText(s,i.width/2,i.height/2-60),e.font="18px sans-serif",e.fillStyle="#ccc",e.fillText("Session Stats:",i.width/2,i.height/2-20),A&&A.length>0){A.sort((x,y)=>y.conversions-x.conversions);let E=i.height/2+10;e.textAlign="left";const d=i.width/2-150,g=i.width/2+0,_=i.width/2+70,h=i.width/2+140;e.fillStyle="#fff",e.fillText("Player",d,E),e.fillText("Conv",g,E),e.fillText("Deaths",_,E),e.fillText("Wins",h,E),E+=25,A.forEach((x,y)=>{var u;y<5&&(e.fillStyle=p[((u=t.find(O=>O.playerName===x.playerName))==null?void 0:u.team)??0]||"#fff",e.fillText(x.playerName.substring(0,8),d,E),e.fillStyle="#fff",e.fillText(x.conversions.toString(),g,E),e.fillText(x.deathsByConversion.toString(),_,E),e.fillText(x.gamesWon.toString(),h,E),E+=20)})}else e.textAlign="center",e.fillText("No persistent stats yet.",i.width/2,i.height/2+10);if(e.textAlign="center",e.font="24px sans-serif",e.fillStyle="white",e.fillText("Click Restart or wait for new players",i.width/2,i.height/2+130),l){if(!document.getElementById("restartButton")){const d=document.createElement("button");d.id="restartButton",d.textContent="Restart Game",d.style.position="absolute",d.style.left="50%",d.style.top="calc(50% + 170px)",d.style.transform="translate(-50%, -50%)",d.style.padding="10px 20px",d.style.fontSize="20px",d.style.cursor="pointer",d.onclick=()=>{console.log("Restart button clicked! WebSocket state:",m.readyState),m.readyState===WebSocket.OPEN?(console.log("Sending restart_game message..."),m.send(JSON.stringify({type:"restart_game"})),d.remove(),console.log("Restart message sent and button removed")):(console.warn("Could not send restart_game: WebSocket not open. State:",m.readyState),alert("Connection issue: Please wait and try again."))},document.body.appendChild(d)}}else{const E=document.getElementById("restartButton");E&&E.remove()}return}a.forEach(s=>{e.fillStyle=s.teamColor;const E=i.width/2+s.x*(i.width/2),d=i.height/2+s.y*(i.height/2),g=s.power?ne*(1+s.power/2):ne;e.beginPath(),e.arc(E,d,g,0,2*Math.PI),e.fill()}),t.forEach(s=>{const E=i.width/2+s.ratioX*(i.width/2),d=i.height/2+s.ratioY*(i.height/2);let g=ae.get(s.id);g||(g={x:E,y:d},ae.set(s.id,g)),g.x+=(E-g.x)*Ce,g.y=d;const _=g.x,h=g.y;if(e.fillStyle=p[s.team]||"#000",e.beginPath(),e.arc(_,h,N,0,2*Math.PI),e.fill(),s.wetnessLevel>0){const y=Math.min(s.wetnessLevel/be,1);e.save();const u=y*2*N,O=_-N,D=h+N-u;e.beginPath(),e.rect(O,D,2*N,u),e.clip();const W=(s.team+1)%p.length,ce=p[W]||"#888888";e.fillStyle=Xe(ce,.75),e.beginPath(),e.arc(_,h,N,0,2*Math.PI),e.fill(),e.restore()}if(Math.sqrt(s.aimX*s.aimX+s.aimY*s.aimY)>k&&!s.isUmbrellaOpen){const y=_+s.aimX*te,u=h+s.aimY*te;e.fillStyle=p[s.team]||"#000",e.beginPath(),e.arc(y,u,Re,0,2*Math.PI),e.fill()}if(s.isUmbrellaOpen){e.save();const y=Math.sqrt(s.aimX*s.aimX+s.aimY*s.aimY);let u=1;if(y>k){const W=Math.min(y,1);u=1+($e-1)*W}const O=Be*u;e.translate(_,h),e.rotate(s.umbrellaAngle+Math.PI/2);const D=p[s.team]||"#grey";e.fillStyle=D,e.beginPath(),e.fillRect(-se/2,-O-oe,se,oe),e.strokeStyle=D,e.lineWidth=ie,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-O+ie/2),e.stroke(),e.restore()}e.fillStyle=p[s.team]||"#000",e.font=De,e.textAlign="center",e.fillText(s.playerName.substring(0,8),_,h+N+Fe+4)})}let Z=document.hasFocus();window.addEventListener("focus",()=>Z=!0);window.addEventListener("blur",()=>Z=!1);function J(){if(!Z)return requestAnimationFrame(J);navigator.getGamepads().forEach((t,a)=>{if(!t)return;if(!(a in M)){const f=`${G}-${a}`;M[a]=f,Y[f]=t.buttons.map(()=>!1),H[f]=!1}const r=M[a],n=t.buttons.map(f=>f.pressed),l=Y[r],c=t.axes.map(f=>Math.abs(f)>k?f:0),A=c.some(f=>f!==0),L=n.some((f,b)=>f&&!l[b]),T=A&&!H[r];if((L||T)&&!C.has(r)){const f=q(r);C.set(r,f),m.readyState===WebSocket.OPEN&&m.send(JSON.stringify({type:"init",clientId:r,playerName:f}))}const v=n[9],$=l[9];v&&!$&&le&&m.readyState===WebSocket.OPEN&&m.send(JSON.stringify({type:"restart_game"})),Y[r]=n,H[r]=A,m.readyState===WebSocket.OPEN&&m.send(JSON.stringify({type:"input",clientId:r,axes:c,buttons:n}))}),requestAnimationFrame(J)}J();window.addEventListener("gamepaddisconnected",o=>{const t=o.gamepad.index,a=M[t];a&&m.readyState===WebSocket.OPEN&&m.send(JSON.stringify({type:"disconnect",clientId:a})),delete M[t]});window.addEventListener("gamepadconnected",o=>{const t=o.gamepad.index,a=`${G}-${t}`;M[t]=a});let P=["Team 1","Team 2"];const M={},Y={},H={};let le=!1;
