(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))f(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const l of d.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&f(l)}).observe(document,{childList:!0,subtree:!0});function r(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerPolicy&&(d.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?d.credentials="include":o.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function f(o){if(o.ep)return;o.ep=!0;const d=r(o);fetch(o.href,d)}})();const Y=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;console.log("Client ID:",Y);const ne=[{id:"level1",name:"Level 1"},{id:"level2",name:"Level 2"}];let O=ne[0].id;const g=document.createElement("div");g.style.position="fixed";g.style.top="10px";g.style.left="10px";g.style.zIndex="100";g.style.background="rgba(255,255,255,0.8)";g.style.padding="5px";const T=document.createElement("select");ne.forEach(i=>{const t=document.createElement("option");t.value=i.id,t.text=i.name,T.appendChild(t)});T.value=O;g.appendChild(T);const P=document.createElement("span");P.textContent="Connecting...";P.style.marginLeft="10px";g.appendChild(P);const k=document.createElement("div");k.style.marginTop="5px";k.innerHTML='Game Scores: <span id="team0name">Team 1</span>: <span id="team0score" style="font-weight: bold;">0</span> - <span id="team1name">Team 2</span>: <span id="team1score" style="font-weight: bold;">0</span>';g.appendChild(k);const H=document.createElement("div");H.style.marginTop="5px";H.innerHTML='Session Wins: <span id="team0sessionname">Team 1</span>: <span id="team0sessionwins" style="font-weight: bold;">0</span> - <span id="team1sessionname">Team 2</span>: <span id="team1sessionwins" style="font-weight: bold;">0</span>';g.appendChild(H);const J=document.createElement("div");J.style.marginTop="5px";J.innerHTML='Friendly Fire: <span id="ffStatus">ON</span>';g.appendChild(J);document.body.appendChild(g);const s=document.getElementById("gameCanvas"),e=s.getContext("2d");s.width=window.innerWidth;s.height=window.innerHeight;function ae(){s.width=window.innerWidth,s.height=window.innerHeight}window.addEventListener("resize",ae);let c,D=0;const F=new Map;function U(i){if(F.has(i))return F.get(i);let t=localStorage.getItem(`fiveteenPlayerName_${i}`);if(!t){const r=i.includes("-")?i.split("-").pop():i;t=prompt(`Enter player name for controller ${r} (max 8 characters):`),t&&t.length>8&&(t=t.substring(0,8)),t||(t=`Player${Math.floor(Math.random()*1e3)}`),localStorage.setItem(`fiveteenPlayerName_${i}`,t)}return F.set(i,t),t}function se(){c=new WebSocket(`ws://${window.location.hostname}:8080`),c.addEventListener("open",()=>{D=0,P.textContent="Connected",Object.entries(v).forEach(([i,t])=>{c.send(JSON.stringify({type:"init",clientId:t,playerName:U(t)}))})}),c.addEventListener("message",i=>{try{const t=JSON.parse(i.data);t.type==="state"?pe(t.state):t.type==="level"&&(O=t.levelId,T.value=O)}catch{}}),c.addEventListener("close",()=>{P.textContent="Disconnected";const i=Math.min(1e4,1e3*2**D);D++,setTimeout(se,i)}),c.addEventListener("error",i=>{P.textContent="Error"})}se();function re(i,t){let r=0,f=0,o=0;const d=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;i=i.replace(d,(w,N,b,C)=>"#"+N+N+b+b+C+C);const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);return l?(r=parseInt(l[1],16),f=parseInt(l[2],16),o=parseInt(l[3],16),`rgba(${r}, ${f}, ${o}, ${t})`):`rgba(255, 255, 255, ${t})`}T.addEventListener("change",()=>{O=T.value,c.readyState===WebSocket.OPEN&&c.send(JSON.stringify({type:"level",levelId:O}))});const y=20,j=38,le=8,ie=.1,Z=8,ce=100,de=.2,Q=y*2.5,V=y*.3,ee=y*.1,me="12px sans-serif",fe=5;let I=["Team 1","Team 2"];const E=["#f00","#00f"],te=new Map;function pe(i){e.clearRect(0,0,s.width,s.height);const{players:t,balloons:r,teamScores:f,friendlyFireEnabled:o,gameOver:d,winningTeam:l,persistentPlayerStats:w,teamSessionWins:N,teamNames:b}=i;b&&b.length>0&&(I=b);const C=document.getElementById("team0score"),q=document.getElementById("team1score"),M=document.getElementById("team0name"),_=document.getElementById("team1name");C&&q&&f&&M&&_&&(M.textContent=I[0],M.style.color=E[0],C.textContent=f[0].toString(),_.textContent=I[1],_.style.color=E[1],q.textContent=f[1].toString());const z=document.getElementById("team0sessionwins"),K=document.getElementById("team1sessionwins"),B=document.getElementById("team0sessionname"),W=document.getElementById("team1sessionname");z&&K&&N&&B&&W&&(B.textContent=I[0],B.style.color=E[0],z.textContent=N[0].toString(),W.textContent=I[1],W.style.color=E[1],K.textContent=N[1].toString());const R=document.getElementById("ffStatus");if(R&&(R.textContent=o?"ON":"OFF",R.style.color=o?"green":"red"),d){e.fillStyle="rgba(0, 0, 0, 0.75)",e.fillRect(0,0,s.width,s.height),e.font="48px sans-serif",e.fillStyle="white",e.textAlign="center";const n=l!==null?`${I[l]} Wins!`:"Game Over!";if(e.fillText(n,s.width/2,s.height/2-60),e.font="18px sans-serif",e.fillStyle="#ccc",e.fillText("Session Stats:",s.width/2,s.height/2-20),w&&w.length>0){w.sort((p,L)=>L.conversions-p.conversions);let a=s.height/2+10;e.textAlign="left";const u=s.width/2-150,h=s.width/2+0,$=s.width/2+70,S=s.width/2+140;e.fillStyle="#fff",e.fillText("Player",u,a),e.fillText("Conv",h,a),e.fillText("Deaths",$,a),e.fillText("Wins",S,a),a+=25,w.forEach((p,L)=>{var A;L<5&&(e.fillStyle=E[((A=t.find(oe=>oe.playerName===p.playerName))==null?void 0:A.team)??0]||"#fff",e.fillText(p.playerName.substring(0,8),u,a),e.fillStyle="#fff",e.fillText(p.conversions.toString(),h,a),e.fillText(p.deathsByConversion.toString(),$,a),e.fillText(p.gamesWon.toString(),S,a),a+=20)})}else e.textAlign="center",e.fillText("No persistent stats yet.",s.width/2,s.height/2+10);e.textAlign="center",e.font="24px sans-serif",e.fillStyle="white",e.fillText("Click Restart or wait for new players",s.width/2,s.height/2+130);const x=document.getElementById("restartButton");x&&x.remove();const m=document.createElement("button");m.id="restartButton",m.textContent="Restart Game",m.style.position="absolute",m.style.left="50%",m.style.top="calc(50% + 170px)",m.style.transform="translate(-50%, -50%)",m.style.padding="10px 20px",m.style.fontSize="20px",m.style.cursor="pointer",m.onclick=()=>{c.readyState===WebSocket.OPEN?(c.send(JSON.stringify({type:"restart_game"})),m.remove()):console.warn("Could not send restart_game: WebSocket not open.")},document.body.appendChild(m);return}else{const n=document.getElementById("restartButton");n&&n.remove()}r.forEach(n=>{e.fillStyle=n.teamColor;const x=s.width/2+n.x*(s.width/2),m=s.height/2+n.y*(s.height/2),a=n.power?Z*(1+n.power/2):Z;e.beginPath(),e.arc(x,m,a,0,2*Math.PI),e.fill()}),t.forEach(n=>{const x=s.width/2+n.ratioX*(s.width/2),m=s.height/2+n.ratioY*(s.height/2);let a=te.get(n.id);a||(a={x,y:m},te.set(n.id,a)),a.x+=(x-a.x)*de,a.y=m;const u=a.x,h=a.y;if(e.fillStyle=E[n.team]||"#000",e.beginPath(),e.arc(u,h,y,0,2*Math.PI),e.fill(),n.wetnessLevel>0){const S=Math.min(n.wetnessLevel/ce,1);e.save();const p=S*2*y,L=u-y,A=h+y-p;e.beginPath(),e.rect(L,A,2*y,p),e.clip(),e.fillStyle=n.wetnessColor?re(n.wetnessColor,.5):"rgba(255, 255, 255, 0.5)",e.beginPath(),e.arc(u,h,y,0,2*Math.PI),e.fill(),e.restore()}if(Math.sqrt(n.aimX*n.aimX+n.aimY*n.aimY)>ie&&!n.isUmbrellaOpen){const S=u+n.aimX*j,p=h+n.aimY*j;e.fillStyle=E[n.team]||"#000",e.beginPath(),e.arc(S,p,le,0,2*Math.PI),e.fill()}if(n.isUmbrellaOpen){e.save(),e.translate(u,h),e.rotate(n.umbrellaAngle+Math.PI/2);const S=E[n.team]||"#grey";e.fillStyle=S,e.beginPath(),e.fillRect(-Q/2,-25-V,Q,V),e.strokeStyle=S,e.lineWidth=ee,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-25+ee/2),e.stroke(),e.restore()}e.fillStyle=E[n.team]||"#000",e.font=me,e.textAlign="center",e.fillText(n.playerName.substring(0,8),u,h+y+fe)})}let G=document.hasFocus();window.addEventListener("focus",()=>G=!0);window.addEventListener("blur",()=>G=!1);const v={};function X(){if(!G)return requestAnimationFrame(X);navigator.getGamepads().forEach((t,r)=>{if(!t)return;if(!(r in v)){const l=`${Y}-${r}`;v[r]=l;const w=U(l);c.readyState===WebSocket.OPEN&&c.send(JSON.stringify({type:"init",clientId:l,playerName:w}))}const f=v[r],o=t.axes.map(l=>Math.abs(l)>ie?l:0),d=t.buttons.map(l=>l.pressed);c.readyState===WebSocket.OPEN&&c.send(JSON.stringify({type:"input",clientId:f,axes:o,buttons:d}))}),requestAnimationFrame(X)}X();window.addEventListener("gamepaddisconnected",i=>{const t=i.gamepad.index,r=v[t];r&&c.readyState===WebSocket.OPEN&&c.send(JSON.stringify({type:"disconnect",clientId:r})),delete v[t]});window.addEventListener("gamepadconnected",i=>{const t=i.gamepad.index,r=`${Y}-${t}`;v[t]=r;const f=U(r);c.readyState===WebSocket.OPEN&&c.send(JSON.stringify({type:"init",clientId:r,playerName:f}))});
