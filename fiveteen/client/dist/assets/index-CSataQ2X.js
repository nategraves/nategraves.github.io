(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function a(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(i){if(i.ep)return;i.ep=!0;const r=a(i);fetch(i.href,r)}})();const I=20,de=38,me=8,fe=.1,Ee=8,ge="16px sans-serif",Se=100,pe=I*.7,ue=.2,ye=I*2.5,_e=I*.3,he=I*.5,Ae=I*.1,Le=I+5,Te=3,xe="12px sans-serif",Ne=5,ve=["Team 1","Team 2"],Me=["#f00","#00f"],Ie=Object.freeze(Object.defineProperty({__proto__:null,AIM_OFFSET:de,AIM_RADIUS:me,BALLOON_RADIUS:Ee,BASE_UMBRELLA_OFFSET_Y_PX:Le,DEAD_ZONE:fe,LERP_FACTOR:ue,MAX_WETNESS:Se,PLAYER_NAME_FONT:xe,PLAYER_NAME_OFFSET_Y:Ne,PLAYER_RADIUS:I,SCORE_FONT:ge,TEAM_DISPLAY_NAMES:ve,TEAM_HEX_COLORS:Me,UMBRELLA_HANDLE_LENGTH_PX:he,UMBRELLA_HANDLE_THICKNESS_PX:Ae,UMBRELLA_MAX_REACH_MULTIPLIER_CLIENT:Te,UMBRELLA_THICKNESS_PX:_e,UMBRELLA_WIDTH_PX:ye,WETNESS_RADIUS:pe},Symbol.toStringTag,{value:"Module"}));function Oe(s,t){let a=0,c=0,i=0;const r=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;s=s.replace(r,(A,L,T,N)=>"#"+L+L+T+T+N+N);const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return l?(a=parseInt(l[1],16),c=parseInt(l[2],16),i=parseInt(l[3],16),`rgba(${a}, ${c}, ${i}, ${t})`):`rgba(255, 255, 255, ${t})`}function Pe(s,t,a,c,i){s.addEventListener("open",()=>{a.textContent="Connected",Object.entries(t).forEach(([r,l])=>{s.send(JSON.stringify({type:"init",clientId:l,playerName:q(l)}))})}),s.addEventListener("message",r=>{const l=JSON.parse(r.data);l.type==="state"?i(l.state):l.type==="level"&&(c.value=l.levelId)}),s.addEventListener("close",()=>{a.textContent="Disconnected"}),s.addEventListener("error",()=>{a.textContent="Error"})}const we=Object.freeze(Object.defineProperty({__proto__:null,connectWebSocket:Pe,hexToRgba:Oe},Symbol.toStringTag,{value:"Module"})),{PLAYER_RADIUS:v,AIM_OFFSET:te,AIM_RADIUS:Re,DEAD_ZONE:k,BALLOON_RADIUS:ne,MAX_WETNESS:be,LERP_FACTOR:Ce,UMBRELLA_WIDTH_PX:se,UMBRELLA_THICKNESS_PX:oe,UMBRELLA_HANDLE_THICKNESS_PX:ie,BASE_UMBRELLA_OFFSET_Y_PX:Be,UMBRELLA_MAX_REACH_MULTIPLIER_CLIENT:De,PLAYER_NAME_FONT:Fe,PLAYER_NAME_OFFSET_Y:$e,TEAM_HEX_COLORS:p}=Ie,{hexToRgba:Xe}=we,G=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;console.log("Client ID:",G);const re=[{id:"level1",name:"Level 1"},{id:"level2",name:"Level 2"}];let B=re[0].id;const S=document.createElement("div");S.style.position="fixed";S.style.top="10px";S.style.left="10px";S.style.zIndex="100";S.style.background="rgba(255,255,255,0.8)";S.style.padding="5px";const R=document.createElement("select");re.forEach(s=>{const t=document.createElement("option");t.value=s.id,t.text=s.name,R.appendChild(t)});R.value=B;S.appendChild(R);const w=document.createElement("span");w.textContent="Connecting...";w.style.marginLeft="10px";S.appendChild(w);const z=document.createElement("div");z.style.marginTop="5px";z.innerHTML='Game Scores: <span id="team0name">Team 1</span>: <span id="team0score" style="font-weight: bold;">0</span> - <span id="team1name">Team 2</span>: <span id="team1score" style="font-weight: bold;">0</span>';S.appendChild(z);const K=document.createElement("div");K.style.marginTop="5px";K.innerHTML='Session Wins: <span id="team0sessionname">Team 1</span>: <span id="team0sessionwins" style="font-weight: bold;">0</span> - <span id="team1sessionname">Team 2</span>: <span id="team1sessionwins" style="font-weight: bold;">0</span>';S.appendChild(K);const j=document.createElement("div");j.style.marginTop="5px";j.innerHTML='Friendly Fire: <span id="ffStatus">ON</span>';S.appendChild(j);document.body.appendChild(S);const o=document.getElementById("gameCanvas"),e=o.getContext("2d");o.width=window.innerWidth;o.height=window.innerHeight;function Ue(){o.width=window.innerWidth,o.height=window.innerHeight}window.addEventListener("resize",Ue);let m;const C=new Map;function q(s){if(C.has(s))return C.get(s);let t=localStorage.getItem(`fiveteenPlayerName_${s}`);if(!t){const a=s.includes("-")?s.split("-").pop():s;t=prompt(`Enter player name for controller ${a} (max 8 characters):`),t&&t.length>8&&(t=t.substring(0,8)),t||(t=`Player${Math.floor(Math.random()*1e3)}`),localStorage.setItem(`fiveteenPlayerName_${s}`,t)}return C.set(s,t),t}function We(){m=new WebSocket(`ws://${window.location.hostname}:8080`),m.addEventListener("open",()=>{w.textContent="Connected",Object.entries(M).forEach(([s,t])=>{m.send(JSON.stringify({type:"init",clientId:t,playerName:q(t)}))})}),m.addEventListener("message",s=>{try{const t=JSON.parse(s.data);t.type==="state"?(Ye(t.state),le=t.state.gameOver):t.type==="level"&&(B=t.levelId,R.value=B)}catch{}}),m.addEventListener("close",()=>{w.textContent="Disconnected"}),m.addEventListener("error",()=>{w.textContent="Error"})}We();R.addEventListener("change",()=>{B=R.value,m.readyState===WebSocket.OPEN&&m.send(JSON.stringify({type:"level",levelId:B}))});const ae=new Map;function Ye(s){e.clearRect(0,0,o.width,o.height);const{players:t,balloons:a,teamScores:c,friendlyFireEnabled:i,gameOver:r,winningTeam:l,persistentPlayerStats:A,teamSessionWins:L,teamNames:T}=s;T&&T.length>0&&(P=T);const N=document.getElementById("team0score"),D=document.getElementById("team1score"),f=document.getElementById("team0name"),b=document.getElementById("team1name");N&&D&&c&&f&&b&&(f.textContent=P[0],f.style.color=p[0],N.textContent=c[0].toString(),b.textContent=P[1],b.style.color=p[1],D.textContent=c[1].toString());const Q=document.getElementById("team0sessionwins"),V=document.getElementById("team1sessionwins"),$=document.getElementById("team0sessionname"),X=document.getElementById("team1sessionname");Q&&V&&L&&$&&X&&($.textContent=P[0],$.style.color=p[0],Q.textContent=L[0].toString(),X.textContent=P[1],X.style.color=p[1],V.textContent=L[1].toString());const U=document.getElementById("ffStatus");U&&(U.textContent=i?"ON":"OFF",U.style.color=i?"green":"red");const ee=document.getElementById("restartButton");if(ee&&ee.remove(),r){e.fillStyle="rgba(0, 0, 0, 0.75)",e.fillRect(0,0,o.width,o.height),e.font="48px sans-serif",e.fillStyle="white",e.textAlign="center";const n=l!==null?`${P[l]} Wins!`:"Game Over!";if(e.fillText(n,o.width/2,o.height/2-60),e.font="18px sans-serif",e.fillStyle="#ccc",e.fillText("Session Stats:",o.width/2,o.height/2-20),A&&A.length>0){A.sort((x,u)=>u.conversions-x.conversions);let E=o.height/2+10;e.textAlign="left";const d=o.width/2-150,g=o.width/2+0,_=o.width/2+70,h=o.width/2+140;e.fillStyle="#fff",e.fillText("Player",d,E),e.fillText("Conv",g,E),e.fillText("Deaths",_,E),e.fillText("Wins",h,E),E+=25,A.forEach((x,u)=>{var y;u<5&&(e.fillStyle=p[((y=t.find(O=>O.playerName===x.playerName))==null?void 0:y.team)??0]||"#fff",e.fillText(x.playerName.substring(0,8),d,E),e.fillStyle="#fff",e.fillText(x.conversions.toString(),g,E),e.fillText(x.deathsByConversion.toString(),_,E),e.fillText(x.gamesWon.toString(),h,E),E+=20)})}else e.textAlign="center",e.fillText("No persistent stats yet.",o.width/2,o.height/2+10);if(e.textAlign="center",e.font="24px sans-serif",e.fillStyle="white",e.fillText("Click Restart or wait for new players",o.width/2,o.height/2+130),r){if(!document.getElementById("restartButton")){const d=document.createElement("button");d.id="restartButton",d.textContent="Restart Game",d.style.position="absolute",d.style.left="50%",d.style.top="calc(50% + 170px)",d.style.transform="translate(-50%, -50%)",d.style.padding="10px 20px",d.style.fontSize="20px",d.style.cursor="pointer",d.onclick=()=>{console.log("Restart button clicked! WebSocket state:",m.readyState),m.readyState===WebSocket.OPEN?(console.log("Sending restart_game message..."),m.send(JSON.stringify({type:"restart_game"})),d.remove(),console.log("Restart message sent and button removed")):(console.warn("Could not send restart_game: WebSocket not open. State:",m.readyState),alert("Connection issue: Please wait and try again."))},document.body.appendChild(d)}}else{const E=document.getElementById("restartButton");E&&E.remove()}return}a.forEach(n=>{e.fillStyle=n.teamColor;const E=o.width/2+n.x*(o.width/2),d=o.height/2+n.y*(o.height/2),g=n.power?ne*(1+n.power/2):ne;e.beginPath(),e.arc(E,d,g,0,2*Math.PI),e.fill()}),t.forEach(n=>{const E=o.width/2+n.ratioX*(o.width/2),d=o.height/2+n.ratioY*(o.height/2);let g=ae.get(n.id);g||(g={x:E,y:d},ae.set(n.id,g)),g.x+=(E-g.x)*Ce,g.y=d;const _=g.x,h=g.y;if(e.fillStyle=p[n.team]||"#000",e.beginPath(),e.arc(_,h,v,0,2*Math.PI),e.fill(),n.wetnessLevel>0){const u=Math.min(n.wetnessLevel/be,1);e.save();const y=u*2*v,O=_-v,F=h+v-y;e.beginPath(),e.rect(O,F,2*v,y),e.clip();const W=(n.team+1)%p.length,ce=p[W]||"#888888";e.fillStyle=Xe(ce,.75),e.beginPath(),e.arc(_,h,v,0,2*Math.PI),e.fill(),e.restore()}if(Math.sqrt(n.aimX*n.aimX+n.aimY*n.aimY)>k&&!n.isUmbrellaOpen){const u=_+n.aimX*te,y=h+n.aimY*te;e.fillStyle=p[n.team]||"#000",e.beginPath(),e.arc(u,y,Re,0,2*Math.PI),e.fill()}if(n.isUmbrellaOpen){e.save();const u=Math.sqrt(n.aimX*n.aimX+n.aimY*n.aimY);let y=1;if(u>k){const W=Math.min(u,1);y=1+(De-1)*W}const O=Be*y;e.translate(_,h),e.rotate(n.umbrellaAngle+Math.PI/2);const F=p[n.team]||"#grey";e.fillStyle=F,e.beginPath(),e.fillRect(-se/2,-O-oe,se,oe),e.strokeStyle=F,e.lineWidth=ie,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-O+ie/2),e.stroke(),e.restore()}e.fillStyle=p[n.team]||"#000",e.font=Fe,e.textAlign="center",e.fillText(n.playerName.substring(0,8),_,h+v+$e+4)})}let Z=document.hasFocus();window.addEventListener("focus",()=>Z=!0);window.addEventListener("blur",()=>Z=!1);function J(){if(!Z)return requestAnimationFrame(J);navigator.getGamepads().forEach((t,a)=>{if(!t)return;if(!(a in M)){const f=`${G}-${a}`;M[a]=f,Y[f]=t.buttons.map(()=>!1),H[f]=!1}const c=M[a],i=t.buttons.map(f=>f.pressed),r=Y[c],l=t.axes.map(f=>Math.abs(f)>k?f:0),A=l.some(f=>f!==0),L=i.some((f,b)=>f&&!r[b]),T=A&&!H[c];if((L||T)&&!C.has(c)){const f=q(c);C.set(c,f),m.readyState===WebSocket.OPEN&&m.send(JSON.stringify({type:"init",clientId:c,playerName:f}))}const N=i[9],D=r[9];N&&!D&&le&&m.readyState===WebSocket.OPEN&&m.send(JSON.stringify({type:"restart_game"})),Y[c]=i,H[c]=A,m.readyState===WebSocket.OPEN&&m.send(JSON.stringify({type:"input",clientId:c,axes:l,buttons:i}))}),requestAnimationFrame(J)}J();window.addEventListener("gamepaddisconnected",s=>{const t=s.gamepad.index,a=M[t];a&&m.readyState===WebSocket.OPEN&&m.send(JSON.stringify({type:"disconnect",clientId:a})),delete M[t]});window.addEventListener("gamepadconnected",s=>{const t=s.gamepad.index,a=`${G}-${t}`;M[t]=a});let P=["Team 1","Team 2"];const M={},Y={},H={};let le=!1;
