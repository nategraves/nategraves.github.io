(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function l(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=l(s);fetch(s.href,a)}})();const w=20,pe=38,Ee=8,Se=.1,ge=8,ye="16px sans-serif",he=100,Ae=w*.7,_e=.2,Le=w*2.5,xe=w*.3,ve=w*.5,Te=w*.1,Me=w+5,we=3,Ne="12px sans-serif",Re=5,Ie=["Team 1","Team 2"],be=["#f00","#00f"],Oe=Object.freeze(Object.defineProperty({__proto__:null,AIM_OFFSET:pe,AIM_RADIUS:Ee,BALLOON_RADIUS:ge,BASE_UMBRELLA_OFFSET_Y_PX:Me,DEAD_ZONE:Se,LERP_FACTOR:_e,MAX_WETNESS:he,PLAYER_NAME_FONT:Ne,PLAYER_NAME_OFFSET_Y:Re,PLAYER_RADIUS:w,SCORE_FONT:ye,TEAM_DISPLAY_NAMES:Ie,TEAM_HEX_COLORS:be,UMBRELLA_HANDLE_LENGTH_PX:ve,UMBRELLA_HANDLE_THICKNESS_PX:Te,UMBRELLA_MAX_REACH_MULTIPLIER_CLIENT:we,UMBRELLA_THICKNESS_PX:xe,UMBRELLA_WIDTH_PX:Le,WETNESS_RADIUS:Ae},Symbol.toStringTag,{value:"Module"}));function Pe(n,t){let l=0,o=0,s=0;const a=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;n=n.replace(a,(x,_,v,F)=>"#"+_+_+v+v+F+F);const c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return c?(l=parseInt(c[1],16),o=parseInt(c[2],16),s=parseInt(c[3],16),`rgba(${l}, ${o}, ${s}, ${t})`):`rgba(255, 255, 255, ${t})`}function Ce(n,t,l,o,s){n.addEventListener("open",()=>{l.textContent="Connected",Object.entries(t).forEach(([a,c])=>{n.send(JSON.stringify({type:"init",clientId:c,playerName:fe(c)}))})}),n.addEventListener("message",a=>{const c=JSON.parse(a.data);c.type==="state"?s(c.state):c.type==="level"&&(o.value=c.levelId)}),n.addEventListener("close",()=>{l.textContent="Disconnected"}),n.addEventListener("error",()=>{l.textContent="Error"})}const Be=Object.freeze(Object.defineProperty({__proto__:null,connectWebSocket:Ce,hexToRgba:Pe},Symbol.toStringTag,{value:"Module"})),{PLAYER_RADIUS:T,AIM_OFFSET:se,AIM_RADIUS:Ue,DEAD_ZONE:K,BALLOON_RADIUS:ie,MAX_WETNESS:$e,LERP_FACTOR:Fe,UMBRELLA_WIDTH_PX:ae,UMBRELLA_THICKNESS_PX:re,UMBRELLA_HANDLE_THICKNESS_PX:le,BASE_UMBRELLA_OFFSET_Y_PX:De,UMBRELLA_MAX_REACH_MULTIPLIER_CLIENT:Xe,PLAYER_NAME_FONT:We,PLAYER_NAME_OFFSET_Y:Ye,TEAM_HEX_COLORS:S}=Oe,{hexToRgba:He}=Be,de=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,me=[{id:"level1",name:"Level 1"},{id:"level2",name:"Level 2"}];let $=me[0].id;const E=document.createElement("div");E.style.position="fixed";E.style.top="10px";E.style.left="10px";E.style.zIndex="100";E.style.background="rgba(255,255,255,0.8)";E.style.padding="5px";const B=document.createElement("select");me.forEach(n=>{const t=document.createElement("option");t.value=n.id,t.text=n.name,B.appendChild(t)});B.value=$;E.appendChild(B);const O=document.createElement("span");O.textContent="Connecting...";O.style.marginLeft="10px";E.appendChild(O);const Z=document.createElement("div");Z.style.marginTop="5px";Z.innerHTML='Game Scores: <span id="team0name">Team 1</span>: <span id="team0score" style="font-weight: bold;">0</span> - <span id="team1name">Team 2</span>: <span id="team1score" style="font-weight: bold;">0</span>';E.appendChild(Z);const Q=document.createElement("div");Q.style.marginTop="5px";Q.innerHTML='Session Wins: <span id="team0sessionname">Team 1</span>: <span id="team0sessionwins" style="font-weight: bold;">0</span> - <span id="team1sessionname">Team 2</span>: <span id="team1sessionwins" style="font-weight: bold;">0</span>';E.appendChild(Q);const V=document.createElement("div");V.style.marginTop="5px";V.innerHTML='Friendly Fire: <span id="ffStatus">ON</span>';E.appendChild(V);const M=document.createElement("button");M.textContent="Unmute Audio";M.style.marginLeft="10px";E.appendChild(M);document.body.appendChild(E);const r=document.getElementById("gameCanvas"),e=r.getContext("2d");r.width=window.innerWidth;r.height=window.innerHeight;function ke(){r.width=window.innerWidth,r.height=window.innerHeight}window.addEventListener("resize",ke);let m,Ge=0;const U=new Map;function fe(n){if(U.has(n))return U.get(n);let t=localStorage.getItem(`fiveteenPlayerName_${n}`);if(!t){const l=n.includes("-")?n.split("-").pop():n;t=prompt(`Enter player name for controller ${l} (max 8 characters):`),t&&t.length>8&&(t=t.substring(0,8)),t||(t=`Player${Math.floor(Math.random()*1e3)}`),localStorage.setItem(`fiveteenPlayerName_${n}`,t)}return U.set(n,t),t}function Je(){try{const o="wss://fiveteen.netlify.app";m=new WebSocket(o),m.addEventListener("open",()=>{Ge=0,O.textContent="Connected"}),m.addEventListener("message",s=>{if(s.data instanceof Blob){Ke(s.data);return}try{const a=JSON.parse(s.data);a.type==="state"?(je(a.state),ze=a.state.gameOver):a.type==="level"&&($=a.levelId,B.value=$)}catch(a){console.error("Error parsing message data:",a,"Raw data:",s.data)}}),m.addEventListener("close",()=>{O.textContent="Disconnected"}),m.addEventListener("error",s=>{console.error("connectWebSocket: WebSocket error observed:",s),O.textContent="Error"})}catch(n){console.error("connectWebSocket: CRITICAL ERROR in function execution:",n)}}Je();B.addEventListener("change",()=>{$=B.value,m.readyState===WebSocket.OPEN&&m.send(JSON.stringify({type:"level",levelId:$}))});const ce=new Map;function je(n){e.clearRect(0,0,r.width,r.height);const{players:t,balloons:l,teamScores:o,friendlyFireEnabled:s,gameOver:a,winningTeam:c,persistentPlayerStats:x,teamSessionWins:_,teamNames:v,tilemap:F}=n;v&&v.length>0&&(R=v);const u=document.getElementById("team0score"),D=document.getElementById("team1score"),H=document.getElementById("team0name"),k=document.getElementById("team1name");u&&D&&o&&H&&k&&(H.textContent=R[0],H.style.color=S[0],u.textContent=o[0].toString(),k.textContent=R[1],k.style.color=S[1],D.textContent=o[1].toString());const te=document.getElementById("team0sessionwins"),ne=document.getElementById("team1sessionwins"),G=document.getElementById("team0sessionname"),J=document.getElementById("team1sessionname");te&&ne&&_&&G&&J&&(G.textContent=R[0],G.style.color=S[0],te.textContent=_[0].toString(),J.textContent=R[1],J.style.color=S[1],ne.textContent=_[1].toString());const j=document.getElementById("ffStatus");j&&(j.textContent=s?"ON":"OFF",j.style.color=s?"green":"red");const oe=document.getElementById("restartButton");if(oe&&oe.remove(),a){e.fillStyle="rgba(0, 0, 0, 0.75)",e.fillRect(0,0,r.width,r.height),e.font="48px sans-serif",e.fillStyle="white",e.textAlign="center";const i=c!==null?`${R[c]} Wins!`:"Game Over!";if(e.fillText(i,r.width/2,r.height/2-60),e.font="18px sans-serif",e.fillStyle="#ccc",e.fillText("Session Stats:",r.width/2,r.height/2-20),x&&x.length>0){x.sort((L,g)=>g.conversions-L.conversions);let f=r.height/2+10;e.textAlign="left";const d=r.width/2-150,p=r.width/2+0,h=r.width/2+70,A=r.width/2+140;e.fillStyle="#fff",e.fillText("Player",d,f),e.fillText("Conv",p,f),e.fillText("Deaths",h,f),e.fillText("Wins",A,f),f+=25,x.forEach((L,g)=>{var y;g<5&&(e.fillStyle=S[((y=t.find(N=>N.playerName===L.playerName))==null?void 0:y.team)??0]||"#fff",e.fillText(L.playerName.substring(0,8),d,f),e.fillStyle="#fff",e.fillText(L.conversions.toString(),p,f),e.fillText(L.deathsByConversion.toString(),h,f),e.fillText(L.gamesWon.toString(),A,f),f+=20)})}else e.textAlign="center",e.fillText("No persistent stats yet.",r.width/2,r.height/2+10);if(e.textAlign="center",e.font="24px sans-serif",e.fillStyle="white",e.fillText("Click Restart or wait for new players",r.width/2,r.height/2+130),a){if(!document.getElementById("restartButton")){const d=document.createElement("button");d.id="restartButton",d.textContent="Restart Game",d.style.position="absolute",d.style.left="50%",d.style.top="calc(50% + 170px)",d.style.transform="translate(-50%, -50%)",d.style.padding="10px 20px",d.style.fontSize="20px",d.style.cursor="pointer",d.onclick=()=>{m.readyState===WebSocket.OPEN?(m.send(JSON.stringify({type:"restart_game"})),d.remove()):(console.warn("Could not send restart_game: WebSocket not open. State:",m.readyState),alert("Connection issue: Please wait and try again."))},document.body.appendChild(d)}}else{const f=document.getElementById("restartButton");f&&f.remove()}return}l.forEach(i=>{e.fillStyle=i.teamColor;const f=r.width/2+i.x*(r.width/2),d=r.height/2+i.y*(r.height/2),p=i.power?ie*(1+i.power/2):ie;e.beginPath(),e.arc(f,d,p,0,2*Math.PI),e.fill()}),t.forEach(i=>{const f=r.width/2+i.ratioX*(r.width/2),d=r.height/2+i.ratioY*(r.height/2);let p=ce.get(i.id);p||(p={x:f,y:d},ce.set(i.id,p)),p.x+=(f-p.x)*Fe,p.y=d;const h=p.x,A=p.y;if(e.fillStyle=S[i.team]||"#000",e.beginPath(),e.arc(h,A,T,0,2*Math.PI),e.fill(),i.wetnessLevel>0){const g=Math.min(i.wetnessLevel/$e,1);e.save();const y=g*2*T,N=h-T,X=A+T-y;e.beginPath(),e.rect(N,X,2*T,y),e.clip();const z=(i.team+1)%S.length,ue=S[z]||"#888888";e.fillStyle=He(ue,.75),e.beginPath(),e.arc(h,A,T,0,2*Math.PI),e.fill(),e.restore()}if(Math.sqrt(i.aimX*i.aimX+i.aimY*i.aimY)>K&&!i.isUmbrellaOpen){const g=h+i.aimX*se,y=A+i.aimY*se;e.fillStyle=S[i.team]||"#000",e.beginPath(),e.arc(g,y,Ue,0,2*Math.PI),e.fill()}if(i.isUmbrellaOpen){e.save();const g=Math.sqrt(i.aimX*i.aimX+i.aimY*i.aimY);let y=1;if(g>K){const z=Math.min(g,1);y=1+(Xe-1)*z}const N=De*y;e.translate(h,A),e.rotate(i.umbrellaAngle+Math.PI/2);const X=S[i.team]||"#grey";e.fillStyle=X,e.beginPath(),e.fillRect(-ae/2,-N-re,ae,re),e.strokeStyle=X,e.lineWidth=le,e.beginPath(),e.moveTo(0,0),e.lineTo(0,-N+le/2),e.stroke(),e.restore()}e.fillStyle=S[i.team]||"#000",e.font=We,e.textAlign="center",e.fillText(i.playerName.substring(0,8),h,A+T+Ye+4)})}let ee=document.hasFocus();window.addEventListener("focus",()=>ee=!0);window.addEventListener("blur",()=>ee=!1);function q(){if(!ee)return requestAnimationFrame(q);navigator.getGamepads().forEach((t,l)=>{if(!t)return;const o=P[l]||`${de}-${l}`;P[l]||(P[l]=o,I[o]=t.buttons.map(()=>!1),b[o]=!1);const s=t.buttons.map(u=>u.pressed),a=t.axes.map(u=>Math.abs(u)>K?u:0),c=a.some(u=>u!==0);I[o]===void 0&&(I[o]=t.buttons.map(()=>!1)),b[o]===void 0&&(b[o]=!1);const x=I[o],_=b[o];if((s.some((u,D)=>u&&!x[D])||c&&!_)&&!U.has(o)){const u=fe(o);m.readyState===WebSocket.OPEN?m.send(JSON.stringify({type:"init",clientId:o,playerName:u})):(console.warn(`pollGamepad: Cannot send init for ${o}. WebSocket not open. State: ${m.readyState}. Will allow retry.`),U.delete(o))}I[o]=s,b[o]=c,m.readyState===WebSocket.OPEN&&m.send(JSON.stringify({type:"input",clientId:o,axes:a,buttons:s}))}),requestAnimationFrame(q)}q();window.addEventListener("gamepaddisconnected",n=>{const t=n.gamepad.index,l=P[t];l&&m.readyState===WebSocket.OPEN&&m.send(JSON.stringify({type:"disconnect",clientId:l})),delete P[t]});window.addEventListener("gamepadconnected",n=>{const t=n.gamepad,l=t.index,o=`${de}-${l}`;P[l]=o,I[o]=t.buttons.map(()=>!1),b[o]=!1});let R=["Team 1","Team 2"];const P={},I={},b={};let ze=!1,C=null,W=null,Y=!0;function Ke(n){const t=URL.createObjectURL(n),l=new Audio(t);l.play().catch(()=>{}),l.onended=()=>URL.revokeObjectURL(t)}function qe(){navigator.mediaDevices.getUserMedia({audio:!0}).then(n=>{W=n,C=new MediaRecorder(n),C.ondataavailable=t=>{m&&m.readyState===WebSocket.OPEN&&m.send(t.data)},C.start(250)}).catch(()=>{Y=!0,M.textContent="Unmute Audio"})}function Ze(){C&&C.stop(),W&&W.getTracks().forEach(n=>n.stop()),C=null,W=null}function Qe(){Y?(qe(),M.textContent="Mute Audio"):(Ze(),M.textContent="Unmute Audio"),Y=!Y}M.addEventListener("click",Qe);
