<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Preview Colors</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.5.3/css/bulma.css" />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tinycolor/1.4.1/tinycolor.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.16.4/math.js"></script>
    <script>
      function buildPalette() {
        const colors = $('.input').val().split(/[ ,]+/).sort(function(a, b) {
          return tinycolor(a).getBrightness() - tinycolor(b).getBrightness();
        });
        const palette = $('<div class="palette tile is-parent is-12"></div>');
        for (let i = 0; i < colors.length; i += 1) {
          const color = colors[i];
          const bgColor = tinycolor(color);
          const bgStyle = `background-color: ${bgColor.toHexString()};`;
          const lightClass = bgColor.isLight() ? 'light' : 'dark';
          const colorText = `<p class="${lightClass}">${bgColor.toHexString()}</p>`;
          const colorMarkup = $(
            `<div class="color tile is-vertical" style="${bgStyle}">${colorText}</div>`
          );

          const colorsClone = colors.slice();
          colorsClone.splice(i, 1)
          const randPairs = math.pickRandom(colorsClone, 2); 
          for (let j = 0; j < randPairs.length; j += 1) {
            colorMarkup.append(`<div class="pair" style="background-color: ${tinycolor(randPairs[j]).toHexString()};"></div>`)

          }
          palette.append(colorMarkup);
        }
        $('.palettes').append(palette);
        $('.input').val('');
      }

      $(function() {
        $('.preview').on('click', function() {
          buildPalette();
        });

        $('.color-form').on('submit', function(e) {
          e.preventDefault();
          buildPalette();
        })
      })
    </script>
	</head>
	<body>
    <section class="section">
      <div class="container">
        <label class="label">Colors</label>
        <div class="field has-addons">
          <div class="control is-expanded">
            <form class="color-form">
              <input id="colors-input" class="input" type="text" placeholder="Enter Colors">
            </form>
          </div>
          <div class="control">
            <a class="button is-info preview">Preview</a>
          </div>
        </div>
      </div>
    </section>
    <section>
      <div class="container">
        <div class="palettes tile is-ancestor"></div>
      </div>
    </section>
  </body>
</html>